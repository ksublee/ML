<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>12&nbsp; XGBoost – Statistical Machine Learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./13. LightGBM.html" rel="next">
<link href="./11. Boosting.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-70a47bd5681a7291082a5b9f83d58762.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./12. XGBoost.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">XGBoost</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Statistical Machine Learning</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01. Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">통계적 기계 학습 개요</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02. Model_evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">모형 정확성 평가</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03. Linear regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04. Classification - Logistic Regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Classification</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05. Classficatrion - LDA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Linear discriminant analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06. Resampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Resampling method</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07. Regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Linear model selection and model regularization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08. Tree.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Tree-based method</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09. Bagging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">앙상블 기법</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10. Random forest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Random forest</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11. Boosting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Boosting</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12. XGBoost.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">XGBoost</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13. LightGBM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">LightGBM</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14. Unsupervised.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Unsupervised vs Supervised Learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15. SVM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Support vector machine</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#tree" id="toc-tree" class="nav-link active" data-scroll-target="#tree"><span class="header-section-number">12.0.1</span> Tree</a></li>
  <li><a href="#규제항" id="toc-규제항" class="nav-link" data-scroll-target="#규제항"><span class="header-section-number">12.0.2</span> 규제항</a></li>
  <li><a href="#차-근사" id="toc-차-근사" class="nav-link" data-scroll-target="#차-근사"><span class="header-section-number">12.0.3</span> 2차 근사</a></li>
  <li><a href="#structure-score" id="toc-structure-score" class="nav-link" data-scroll-target="#structure-score"><span class="header-section-number">12.0.4</span> Structure score</a></li>
  <li><a href="#실제-학습-과정" id="toc-실제-학습-과정" class="nav-link" data-scroll-target="#실제-학습-과정"><span class="header-section-number">12.0.5</span> 실제 학습 과정</a></li>
  <li><a href="#요약" id="toc-요약" class="nav-link" data-scroll-target="#요약"><span class="header-section-number">12.0.6</span> 요약</a></li>
  <li><a href="#xgboost" id="toc-xgboost" class="nav-link" data-scroll-target="#xgboost"><span class="header-section-number">12.0.7</span> XGBoost</a></li>
  <li><a href="#예제-iris-데이터" id="toc-예제-iris-데이터" class="nav-link" data-scroll-target="#예제-iris-데이터"><span class="header-section-number">12.0.8</span> 예제 : Iris 데이터</a></li>
  <li><a href="#예제-make_hastie_10_2" id="toc-예제-make_hastie_10_2" class="nav-link" data-scroll-target="#예제-make_hastie_10_2"><span class="header-section-number">12.0.9</span> 예제 : <code>make_hastie_10_2</code></a></li>
  <li><a href="#하이퍼-파라미터" id="toc-하이퍼-파라미터" class="nav-link" data-scroll-target="#하이퍼-파라미터"><span class="header-section-number">12.0.10</span> 하이퍼 파라미터</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">XGBoost</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>최적화된 그레디언트 부스팅 구현으로 XGBoost라는 것이 유명하다.</p>
<p>XGBoost는 eXtreme Gradient Boosting의 약자로서, 확장성 때문에 구조화된 데이터에 대한 응용 머신 러닝에서 많이 활용된다.</p>
<p>XGBoost는 gradient boost를 개선한 방법이라고 볼 수 있으며, 속도와 성능을 향상시키도록 특별히 설계되었다.</p>
<p>XGBoost에서 최적화를 위한 목적 함수의 두드러진 특징은 훈련 손실과 규제항의 두 부분으로 구성된다는 것이다.</p>
<p>Regularized learning을 통해 과적합을 피하고, 단순하고 예측가능한 모형을 선택할 수 있게 한다.</p>
<p><span class="math display">\[ \text{obj}(\theta) = L(\theta) + \Omega(\theta) \]</span></p>
<p>Tree 방법에서 정규화항은 일종의 모델 복잡도 (complexity of the tree)로 정의된다.</p>
<p>그 외에 병렬화와 시스템 최적화로 기존의 gradient boosting에 비해 성능이 높다고 알려져 있다.</p>
<p>아래는 <a href="https://xgboost.readthedocs.io/en/stable/tutorials/model.html">XGBoost</a> 패키지의 메뉴얼의 내용을 요약한 것이다.</p>
<p>XGBoost에서 훈련의 핵심은 매 부스팅 스텝마다 tree structure score라는 값을 최소화하는 트리를 찾는 것이다.</p>
<section id="tree" class="level3" data-number="12.0.1">
<h3 data-number="12.0.1" class="anchored" data-anchor-id="tree"><span class="header-section-number">12.0.1</span> Tree</h3>
<p>XGBoost는 CART(Classification And Regression Tree)들이 모인 일종의 앙상블 모형이다.</p>
<p>일반적인 gradient boosting과 동일한 방법으로부터 출발한다.</p>
<p>즉, boosting의 각 step에서 작은 트리 (weak learner)들을 적합한다.</p>
<p>학습된 트리는 이전 단계까지 학습된 모형에 합하는 additive 방식을 취한다.</p>
<p>XGBoost에서는 CART를 형성할 때 마지막 leaf 노드에서 일종의 숫자로 이루어진 실수값 score(예측값)를 배정한다.</p>
<ul>
<li>나중에 설명하는 tree structure score와는 다른 것.</li>
</ul>
<p>예를 들어 A와 B 클래스가 있을 때, score는 높을수록 A 클래스에 속할 확률이 높고, score가 낮을수록 B 클래스에 속할 확률이 높아질 수 있도록 설계할 수 있을 것이다.</p>
<p>이 score는 일종의 모형 모수로서, 최적화의 대상이다.</p>
</section>
<section id="규제항" class="level3" data-number="12.0.2">
<h3 data-number="12.0.2" class="anchored" data-anchor-id="규제항"><span class="header-section-number">12.0.2</span> 규제항</h3>
<p>XGBoost는 모델 복잡도를 낮추기 위해 규제항을 사용한다.</p>
<p>어떤 트리 (weak learner) <span class="math inline">\(f\)</span>에 대한 규제항은 다음과 같이 정의된다.</p>
<p><span class="math display">\[ \Omega(f) = \gamma T + \frac{1}{2} \lambda \sum_{j=1}^{T} w_j^2 \]</span></p>
<p>여기서 <span class="math inline">\(T\)</span>는 <span class="math inline">\(f\)</span>의 leaf node의 수이고, <span class="math inline">\(w_j\)</span>는 각 leaf node의 score이다.</p>
<p><span class="math inline">\(\gamma\)</span>와 <span class="math inline">\(\lambda\)</span>는 hyperparameter이다.</p>
<p>즉, leaf 노드의 숫자가 많을수록, 그리고 leaf node의 score들의 제곱이 클 수록 더 큰 페널티를 받는다.</p>
</section>
<section id="차-근사" class="level3" data-number="12.0.3">
<h3 data-number="12.0.3" class="anchored" data-anchor-id="차-근사"><span class="header-section-number">12.0.3</span> 2차 근사</h3>
<p>XGBoost가 빠른 이유 중 하나는 최적화 단계에서 loss function의 2차 근사를 사용하기 때문이다. (Gradient boosting은 1차 근사)</p>
<ul>
<li><p>2차 근사까지 이용하기 때문에, 수치해석에서 사용되며 비슷한 특징을 지는 Newton-Rapshon 방법과 비견되어, Newton boosting이라 불리우기도 한다.</p></li>
<li><p>최적화 문제에서 gradient descent 방법보다 Newton-Rapshon 방법이 더 빠르다고 알려져 있는데, 이와 비슷한 원리로 XGBoost가 gradient boost보다 효율적.</p></li>
</ul>
<p>트리를 이용한 부스팅에서 step <span class="math inline">\(t\)</span>까지 진행되었을 때 step <span class="math inline">\(t\)</span>에서의 예측값은 다음으로 표현할 수 있다.</p>
<p><span class="math display">\[ \hat y^{(t)}_i = \sum_{k=1}^{t} f_k(x_i) = \hat y_{i}^{(t-1)} + f_t(x_i) \]</span></p>
<p>여기서 <span class="math inline">\(f_t\)</span>는 step <span class="math inline">\(t\)</span>에서 추가되는 트리이다.</p>
<p>XGBoost에서 어떤 loss function <span class="math inline">\(\ell\)</span>에 대해 step <span class="math inline">\(t\)</span>에서의 최적화의 대상이 되는 목적함수는 다음과 같이 표현된다.</p>
<p><span class="math display">\[ \mathrm{obj}^{(t)} = \sum_{i=1}^{n} \ell(y_i, \hat y_{i}^{(t)} ) + \Omega = \sum_{i=1}^{n} \ell(y_i,\hat y_{i}^{(t-1)} + f_t(x_i) ) + \Omega \]</span></p>
<p>Loss function의 두번째 인자에 대해 <span class="math inline">\(\hat y_{i}^{(t-1)}\)</span>에서 Taylor 2차 근사를 하면 <span class="math display">\[ \mathrm{obj}^{(t)} \approx  \sum_{i=1}^{n} \left[\underbrace{\ell(y_i,\hat y_{i}^{(t-1)})}_{\text{constant}} + \underbrace{g_i}_{\text{constant}}f_t(x_i) + \frac{1}{2} \underbrace{h_i}_{\text{constant}} f_t^2(x_i) \right]  + \Omega \]</span></p>
<p>로 표현할 수 있으며, 여기서 <span class="math inline">\(g_i\)</span>와 <span class="math inline">\(h_i\)</span>는 각각 <span class="math inline">\(\ell(y_i, \hat y_{i}^{(t-1)})\)</span>의 두번째 인자에 대한 1차와 2차 미분을 <span class="math inline">\(\hat y_{i}^{(t-1)}\)</span>에서 계산한 값이다:</p>
<p><span class="math display">\[ g_i = \left. \frac{\partial \ell(y_i, \hat y)}{\partial \hat y} \right|_{ \hat y = \hat y_{i}^{(t-1)}} \quad  \left. h_i = \frac{\partial^2 \ell(y_i, \hat y)}{\partial \hat y^2} \right|_{ \hat y = \hat y_{i}^{(t-1)}} \]</span></p>
<ul>
<li>여기서 <span class="math inline">\(g_i\)</span>와 <span class="math inline">\(h_i\)</span>는 <span class="math inline">\(t-1\)</span> 단계까지의 계산된 값으로 산출되며, 즉, 모든 데이터 <span class="math inline">\(i\)</span>에 대해 <span class="math inline">\(t\)</span>단계에 들어가기 전에 이미 결정되어 있음.</li>
<li>예: MSE loss function의 경우 <span class="math inline">\(g_i = \hat y_i^{(t-1)} - y_i\)</span>, <span class="math inline">\(h_i = 1\)</span>.</li>
</ul>
<p>XGBoost 또한 일반적인 gradient boosting에서처럼 각 boosting step에서 새롭게 추가되는 트리 <span class="math inline">\(f_t\)</span>에 대해서만 최적화를 진행하는 additive model이다.</p>
<ul>
<li>모든 가능한 트리에 대해 최적화를 진행하는 것은 어렵기 때문</li>
</ul>
<p>따라서 최적화를 step <span class="math inline">\(t\)</span>에서만 추가되는 트리에 대해서만 진행한다면 목적함수에서 <span class="math inline">\(\ell(y_i,\hat y_{i}^{(t-1)})\)</span>를 생략하고</p>
<p><span class="math display">\[ \mathrm{obj}^{(t)} \approx  \sum_{i=1}^{n} \left[ g_i f_t(x_i) + \frac{1}{2} h_i f_t^2(x_i) \right]  + \Omega \]</span></p>
<p>로 표현할 수 있다.</p>
<p>위 <span class="math inline">\(\mathrm{obj}^{(t)}\)</span>을 최소화하는 트리 <span class="math inline">\(\hat f_t\)</span>를 찾는 것은 다음을 최소화하는 <span class="math inline">\(\hat f_t\)</span>를 찾는 과정과 동치이다.</p>
<p><span class="math display">\[  \sum_{i=1}^{n}  \frac{1}{2} h_i \left[  - \frac{g_i}{h_i} - f_t(x_i) \right]^2  + \Omega \]</span></p>
<ul>
<li><span class="math inline">\(f_t\)</span>를 <span class="math inline">\(- \frac{g_i}{h_i}\)</span>에 적합하는 과정으로, XGBoost에서는 $- $가 gradient boosting의 residual의 역할을 담당한다고 볼 수 있다.</li>
</ul>
</section>
<section id="structure-score" class="level3" data-number="12.0.4">
<h3 data-number="12.0.4" class="anchored" data-anchor-id="structure-score"><span class="header-section-number">12.0.4</span> Structure score</h3>
<p>위 obj 함수는 규제항을 대입하여 다음과 같이 다시 표현할 수 있다.</p>
<p><span class="math display">\[ \mathrm{obj}^{(t)} \approx  \sum_{i=1}^{n} \left[ g_i f_t(x_i) + \frac{1}{2} h_i f_t^2(x_i) \right] +  \gamma T + \frac{1}{2} \lambda \sum_{j=1}^{T} w_j^2 \]</span></p>
<p>한편, 트리를 <span class="math inline">\(f_t(x_i) = w_{q(x_i)}\)</span>로 표현할 수 있는데, 여기서 <span class="math inline">\(q(x_i)\)</span>는 <span class="math inline">\(x_i\)</span>가 최종적으로 도착할 leaf의 index로 mapping하는 함수이다.</p>
<p>그러면,</p>
<p><span class="math display">\[ \mathrm{obj}^{(t)} \approx  \sum_{i=1}^{n} \left[ g_i w_{q(x_i)} + \frac{1}{2} h_i w^2_{q(x_i)} \right] +  \gamma T + \frac{1}{2} \lambda \sum_{j=1}^{T} w_j^2 \]</span></p>
<p>이며, 동일 leaf에서는 동일한 score를 가진다는 점을 이용하면,</p>
<p><span class="math display">\[ \mathrm{obj}^{(t)} \approx \sum_{j=1}^{T} \left[ \left(\sum_{i \in I_j} g_i \right)w_j + \frac{1}{2} \left(\sum_{i \in I_j} h_j + \lambda \right) w_j^2 \right] + \gamma T \]</span></p>
<p>이다. 여기서 <span class="math inline">\(I_j\)</span>는 <span class="math inline">\(j\)</span>번째 leaf node에 최종적으로 도착하는 <span class="math inline">\(i\)</span>들의 집합이다.</p>
<p>간단히 하기 위해 $G_j = <em>{iI_j} g_i $, $H_j = </em>{iI_j} h_i $라고 하면,</p>
<p><span class="math display">\[ \mathrm{obj}^{(t)} \approx \sum_{j=1}^{T} \left[G_j w_j + \frac{1}{2} (H_j + \lambda) w_j^2 \right] + \gamma T \]</span></p>
<p>이며, <span class="math inline">\(w_j\)</span>에 대한 이차식이다.</p>
<p>Leaf node의 스코어를 의미하는 <span class="math inline">\(w_j\)</span>들은 서로 독립적이기 때문에, 각 <span class="math inline">\(j\)</span>별로 optimal point를 구할 수 있다.</p>
<p>위 식을 <span class="math inline">\(w_j\)</span>에 대해 미분하였을 때</p>
<p><span class="math display">\[\frac{\partial \mathrm{obj}^{(t)}}{\partial w_j} = 0\]</span></p>
<p>이 성립하는 위치를 찾으면, 이는</p>
<p><span class="math display">\[ w_j^* = -\frac{G_j}{H_j + \lambda} \]</span></p>
<p>이고, 이를 다시 obj 함수에 대입하면,</p>
<p><span class="math display">\[ \mathrm{obj}^* = - \frac{1}{2} \sum_{j=1}^{T} \frac{G_j^2}{ H_j + \lambda} + \gamma T \]</span></p>
<p>이다.</p>
<p>위 식의 값을 tree structure score라고 부르자.</p>
<ul>
<li><p><span class="math inline">\(t\)</span>단계에서 leaf 노드가 <span class="math inline">\(T\)</span>개 있는 어떤 트리에 대한 structure score. <br><br></p></li>
<li><p>Structure score가 작을수록 좋은 트리이다. <br><br></p></li>
<li><p>일반적인 결정트리에서 impurity measure와 비슷한 역할을 한다. <br><br></p></li>
<li><p><span class="math inline">\(H_j\)</span>와 <span class="math inline">\(G_j\)</span>는 트리의 각 leaf node <span class="math inline">\(j\)</span>에서 <span class="math inline">\(t-1\)</span> 단계의 값들인 <span class="math inline">\(\hat y^{(t-1)}\)</span>들과 loss function을 이용해서 계산되는 값이다.</p></li>
</ul>
</section>
<section id="실제-학습-과정" class="level3" data-number="12.0.5">
<h3 data-number="12.0.5" class="anchored" data-anchor-id="실제-학습-과정"><span class="header-section-number">12.0.5</span> 실제 학습 과정</h3>
<p>각 부스팅 단계에서 최적의 트리를 찾아 보자.</p>
<p>이를 위해서는 위에서 설명한 tree structure score를 모든 가능한 트리마다 계산해 보아야 한다.</p>
<p>모든 가능한 weak learner들, 즉, 모든 가능한 feature variable들과 분할 기준에 대해 tree structure score를 계산해 본 후,</p>
<p>가장 작은 tree structure score를 가지는 트리를 선택하면 된다.</p>
<p>하지만 이는 계산상으로 쉽지 않아 기본적인 결정트리에서의 훈련처럼 일종의 greedy algorithm을 적용한다.</p>
<p>먼저 root로부터 트리의 가지를 한 번 분할하면서, 분할할 때 tree structure score를 최대한 작게 만드는 변수와 분할 지점을 찾는다.</p>
<p>이 때, 트리를 분할할 때 생기는 새로운 leaf node들을 각각 <span class="math inline">\(L\)</span>과 <span class="math inline">\(R\)</span>이라고 한다면, 이 분할을 통해 얻어지는 추가적인 score gain인</p>
<p><span class="math display">\[ \frac{1}{2} \left[ \frac{G_L^2}{H_L + \lambda} + \frac{G_R^2}{H_R + \lambda} - \frac{(G_L + G_R)^2}{H_L + H_R + \lambda} \right] - \gamma\]</span></p>
<p>를 고려한다. (위에서의 <span class="math inline">\(\mathrm{obj}^*\)</span>를 이용해 유도한 식.)</p>
<p><span class="math inline">\(G_L\)</span>과 <span class="math inline">\(H_L\)</span>, 그리고 <span class="math inline">\(G_R\)</span>과 <span class="math inline">\(H_R\)</span>은 새롭게 분할된 두 leaf에서 계산되는 값들이다.</p>
<p>위 식은 트리를 추가적으로 분할할 때 (분할하지 않았을 때에 비해), score 상으로 이득을 얻는지 손해를 보는지 계산하며, 만약 이 값이 0보다 작으면 더이상 트리를 분할하지 않는다.</p>
<p>만약 트리가 분할된다면, 이 과정을 weak learner의 미리 설정해 놓은 max depth에 이르기까지 반복한다.</p>
</section>
<section id="요약" class="level3" data-number="12.0.6">
<h3 data-number="12.0.6" class="anchored" data-anchor-id="요약"><span class="header-section-number">12.0.6</span> 요약</h3>
<ol type="1">
<li><p>초기 모형 <span class="math inline">\(f_0\)</span>은 손실 함수를 최소화하는 상수로 설정, 예를 들어 회귀 문제와 제곱손실함수의 경우 평균값 이용 <br><br></p></li>
<li><p><span class="math inline">\(t = 1, \cdots, T\)</span>에 대해 다음을 반복 <br><br></p>
<ol type="1">
<li><p>root로부터 시작하여 tree structure score를 최소화하는 변수와 분할 지점 계산 <br><br></p></li>
<li><p>Weak learner <span class="math inline">\(f_t\)</span>의 max depth에 도달하거나 score gain이 0보다 큰 동안 지속적으로 분할 시도 (tree structure score를 최소화하는 변수와 분할 지점을 계산) <br><br></p></li>
<li><p>Weak learner <span class="math inline">\(f_t\)</span> 훈련되면 이전까지 훈련된 모형에 <span class="math inline">\(\eta\)</span>의 학습률로 합산 : $f = f_0 +_{i=1}^t f_i $,</p></li>
</ol></li>
</ol>
</section>
<section id="xgboost" class="level3" data-number="12.0.7">
<h3 data-number="12.0.7" class="anchored" data-anchor-id="xgboost"><span class="header-section-number">12.0.7</span> <a href="https://xgboost.readthedocs.io/en/stable/index.html">XGBoost</a></h3>
<p>XGBoost를 구현한 라이브러리로서 python외에도 다양한 언어가 지원된다.</p>
<p>XGBoost 자체는 scikit-learn과는 별도의 라이브러리이지만, XGBoost는 scikit-learn의 인터페이스를 따르는 래퍼 (Wrapper) 클래스를 제공한다.</p>
<p>이를 통해, Scikit-learn과 일관된 API를 이용할 수 있다.</p>
<p>XGBoost의 scikit-learn 래퍼를 사용하려면 xgboost 패키지를 설치한 후, <code>xgboost.XGBRegressor</code> 또는 <code>xgboost.XGBClassifier</code>와 같은 클래스를 import하여 사용할 수 있다.</p>
<p>이러한 클래스는 scikit-learn의 <code>fit</code>, <code>predict</code> 등과 같은 메서드를 제공하여 모델을 학습하고 예측할 수 있도록 한다.</p>
</section>
<section id="예제-iris-데이터" class="level3" data-number="12.0.8">
<h3 data-number="12.0.8" class="anchored" data-anchor-id="예제-iris-데이터"><span class="header-section-number">12.0.8</span> 예제 : Iris 데이터</h3>
<p><a href="https://xgboost.readthedocs.io/en/stable/python/python_api.html#xgboost.XGBClassifier"><code>xgboost.XGBClassifier</code></a>를 이용하여 먼저 간단한 분류 모형을 연습해 보자.</p>
<p>기본적으로 XGBoost의 분류는 binary 분류를 기반으로 하기 때문에, 0과 1의 두 클래스가 있는 경우를 먼저 살펴본다.</p>
<p>Iris data의 y값은 3개의 클래스이나, 간단히 versicolor인지 아닌지 체크하는 문제를 살펴보자.</p>
<div id="a14f2ecd-f8c2-4413-9c6d-e1e599e9c456" class="cell" data-tags="[]" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBClassifier</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="599c7101" class="cell" data-tags="[]" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> load_iris</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load_iris()</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(data[<span class="st">'data'</span>], data[<span class="st">'target'</span>], test_size<span class="op">=</span><span class="fl">.2</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># versicolor or not</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>y_train[y_train <span class="op">!=</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>y_test[y_test <span class="op">!=</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>data.target_names</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>array(['setosa', 'versicolor', 'virginica'], dtype='&lt;U10')</code></pre>
</div>
</div>
<p>연습을 위해 <a href="https://xgboost.readthedocs.io/en/stable/python/python_api.html#xgboost.XGBClassifier"><code>XGBClassifier</code></a>를 이용한 매우 간단한 모형을 살펴보자.</p>
<p>Weak learner는 최대 깊이 1의 stump이다.</p>
<p>Boosting의 단계 수는 2으로 하였다. (보통은 훨씬 많은 단계를 사용한다.)</p>
<p>scikit-learn의 문법과 흡사하게, 분류기를 생성하고 <a href="https://xgboost.readthedocs.io/en/stable/python/python_api.html#xgboost.XGBClassifier.fit"><code>.fit()</code></a> method를 이용해 훈련할 수 있다.</p>
<div id="8095d201" class="cell" data-scrolled="true" data-tags="[]" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>xg_clf <span class="op">=</span> XGBClassifier(n_estimators<span class="op">=</span><span class="dv">2</span>, max_depth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>xg_clf </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=1, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              n_estimators=2, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=None, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">XGBClassifier</label><div class="sk-toggleable__content"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=1, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              n_estimators=2, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=None, ...)</pre></div></div></div></div></div>
</div>
</div>
<div id="ba5b7a3a" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>xg_clf.fit(X_train, y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=1, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              n_estimators=2, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=None, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">XGBClassifier</label><div class="sk-toggleable__content"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=1, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              n_estimators=2, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=None, ...)</pre></div></div></div></div></div>
</div>
</div>
<p>다른 sklearn의 머신러닝 모형들과 비슷하게 <a href="https://xgboost.readthedocs.io/en/stable/python/python_api.html#xgboost.XGBClassifier.predict"><code>.predict()</code></a>를 이용하여 클래스를 예측한다.</p>
<div id="77057152-ba7c-41b3-a8c5-cc652592b429" class="cell" data-tags="[]" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>xg_clf.predict(X_test)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>array([0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1,
       0, 0, 0, 0, 1, 1, 0, 1])</code></pre>
</div>
</div>
<div id="b8222db3-70af-429f-bd02-8e9baa20c7ff" class="cell" data-tags="[]" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 실제 y값과의 비교</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>y_test</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>array([0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1,
       1, 0, 0, 1, 1, 1, 0, 1])</code></pre>
</div>
</div>
<p><a href="https://xgboost.readthedocs.io/en/stable/python/python_api.html#xgboost.XGBClassifier.get_booster">get_booster()</a>를 이용하면 훈련된 개별 트리들을 살펴볼 수 있다.</p>
<p>각 트리를 그대로 출력하면, 인간이 알아볼 수 있는 형태는 아니다.</p>
<div id="f3865be4" class="cell" data-tags="[]" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>booster <span class="op">=</span> xg_clf.get_booster()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 개별 트리들의 feature 변수 이름을 원래 데이터의 feature_names를 이용하여 지정</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>booster.feature_names <span class="op">=</span> <span class="bu">list</span>(data.feature_names)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>individual_trees <span class="op">=</span> <span class="bu">list</span>(booster)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>individual_trees</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>[&lt;xgboost.core.Booster at 0x13c354a24d0&gt;,
 &lt;xgboost.core.Booster at 0x13c354a27d0&gt;]</code></pre>
</div>
</div>
<p>XGBoost의 <a href="https://xgboost.readthedocs.io/en/stable/python/python_api.html#xgboost.Booster"><code>Booster</code></a> 클래스는 XGBoost 라이브러리 내부에서 사용되는 독자적인 트리 혹은 트리 앙상블을 관리하는 구현체라고 볼 수 있다.</p>
<div id="d3c8d8b8" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(booster)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>xgboost.core.Booster</code></pre>
</div>
</div>
<div id="486d63ca" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(individual_trees[<span class="dv">0</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>xgboost.core.Booster</code></pre>
</div>
</div>
<p>위에서 생성한 <a href="https://xgboost.readthedocs.io/en/stable/python/python_api.html#xgboost.Booster"><code>booster</code></a>의 메쏘드인 <a href="https://xgboost.readthedocs.io/en/stable/python/python_api.html#xgboost.Booster.get_dump"><code>get_dump()</code></a>를 이용하면 트리들을 읽을 수 있는 문자열의 형태로 받아올 수 있다.</p>
<p>훈련된 간단한 stump들이 2개 있음을 확인할 수 있으며, 분기 기준 및 leaf node들의 score들을 관찰할 수 있다.</p>
<div id="3c157c1e" class="cell" data-tags="[]" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>tree_list <span class="op">=</span> booster.get_dump()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="251c490c" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tree_list</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>['0:[petal length (cm)&lt;2.5999999] yes=1,no=2,missing=1\n\t1:leaf=-0.545454562\n\t2:leaf=-0.0285714306\n',
 '0:[petal width (cm)&lt;1.6500001] yes=1,no=2,missing=1\n\t1:leaf=0.0378537774\n\t2:leaf=-0.535201311\n']</code></pre>
</div>
</div>
<div id="07817c20" class="cell" data-tags="[]" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, tree <span class="kw">in</span> <span class="bu">enumerate</span>(tree_list):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Tree </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">:</span><span class="ch">\n</span><span class="sc">{</span>tree<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tree 0:
0:[petal length (cm)&lt;2.5999999] yes=1,no=2,missing=1
    1:leaf=-0.545454562
    2:leaf=-0.0285714306


Tree 1:
0:[petal width (cm)&lt;1.6500001] yes=1,no=2,missing=1
    1:leaf=0.0378537774
    2:leaf=-0.535201311

</code></pre>
</div>
</div>
<p>혹은 <a href="https://xgboost.readthedocs.io/en/stable/python/python_api.html#xgboost.Booster.trees_to_dataframe"><code>trees_to_dataframe()</code></a>을 이용한 다음의 방법으로 트리들을 관찰할 수 있다.</p>
<ul>
<li>Gain 열의 값은 leaf 노드에 대해서는 score를 기록하고, non-leaf 노드에서는 노드 분할을 통해 얻는 score gain을 나타낸다.</li>
</ul>
<div id="df5bdf68-c50d-4204-8eeb-9890d839ace2" class="cell" data-scrolled="true" data-tags="[]" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df_tree <span class="op">=</span> booster.trees_to_dataframe()</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>df_tree</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Tree</th>
<th data-quarto-table-cell-role="th">Node</th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">Feature</th>
<th data-quarto-table-cell-role="th">Split</th>
<th data-quarto-table-cell-role="th">Yes</th>
<th data-quarto-table-cell-role="th">No</th>
<th data-quarto-table-cell-role="th">Missing</th>
<th data-quarto-table-cell-role="th">Gain</th>
<th data-quarto-table-cell-role="th">Cover</th>
<th data-quarto-table-cell-role="th">Category</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0</td>
<td>0</td>
<td>0-0</td>
<td>petal length (cm)</td>
<td>2.60</td>
<td>0-1</td>
<td>0-2</td>
<td>0-1</td>
<td>20.941208</td>
<td>30.000000</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>0</td>
<td>1</td>
<td>0-1</td>
<td>Leaf</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-0.545455</td>
<td>10.000000</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>0</td>
<td>2</td>
<td>0-2</td>
<td>Leaf</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-0.028571</td>
<td>20.000000</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1</td>
<td>0</td>
<td>1-0</td>
<td>petal width (cm)</td>
<td>1.65</td>
<td>1-1</td>
<td>1-2</td>
<td>1-1</td>
<td>25.178829</td>
<td>29.287506</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1</td>
<td>1</td>
<td>1-1</td>
<td>Leaf</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.037854</td>
<td>19.789442</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>1</td>
<td>2</td>
<td>1-2</td>
<td>Leaf</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-0.535201</td>
<td>9.498062</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>각 weak learner들을 이용하여 예측을 할 수도 있다. <code>iteration_range</code>를 통해 시작과 끝을 정하여 예측에 사용할 트리들을 지정할 수 있다.</p>
<div id="0e3b2e42-8365-4d99-bec5-821d72589ca1" class="cell" data-tags="[]" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 첫번째 트리만을 이용</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>xg_clf.predict(X_test, iteration_range<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0])</code></pre>
</div>
</div>
<div id="5059f2ab-6a28-4b40-a9dc-327d73da83aa" class="cell" data-tags="[]" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 두번째 트리만을 이용</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>xg_clf.predict(X_test, iteration_range<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>array([1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1,
       0, 0, 1, 0, 1, 1, 1, 1])</code></pre>
</div>
</div>
<div id="95ac67f4-1348-47d5-99ba-5caab59d30cd" class="cell" data-tags="[]" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 전체 모델을 이용</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>xg_clf.predict(X_test)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>array([0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1,
       0, 0, 0, 0, 1, 1, 0, 1])</code></pre>
</div>
</div>
<p>다음의 과정을 통해 leaf score에 따라 분류가 어떻게 이루어지는지 대략적으로 파악할 수 있다.</p>
<p>먼저 <a href="https://xgboost.readthedocs.io/en/stable/python/python_api.html#xgboost.XGBClassifier.apply"><code>apply()</code></a>를 이용하여 테스트 데이터가 각 트리에서 어떤 leaf에 떨어지는지 살펴보자.</p>
<p><code>apply()</code>는 X 값들을 인자로 받아, 각 값들이 어떤 leaf 노드로 떨어지는지 보여준다.</p>
<p>결과의 각 열이 각 트리를 나타내고, 각 열의 숫자값이 leaf의 index를 나타낸다. 각 행은 각 데이터를 나타낸다.</p>
<div id="00203e2a-6111-43d1-b30f-e3bab672a7af" class="cell" data-tags="[]" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>df_X_test <span class="op">=</span> pd.DataFrame(X_test, columns<span class="op">=</span>data.feature_names)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>applied <span class="op">=</span> xg_clf.<span class="bu">apply</span>(df_X_test)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>applied[:<span class="dv">10</span>, ]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>array([[1., 1.],
       [2., 1.],
       [1., 1.],
       [1., 1.],
       [2., 2.],
       [2., 2.],
       [2., 2.],
       [2., 2.],
       [1., 1.],
       [2., 1.]], dtype=float32)</code></pre>
</div>
</div>
<p>지금의 예제에서는 부스팅에 사용한 트리가 2개 밖에 없으므로, 다음의 간단한 코드를 통해 test 데이터가 어떤 스코어를 가지는지 계산해 볼 수 있다.</p>
<p>해당 스코어에 따라 어떤 클래스로 prediction이 이루어졌는지 살펴보자.</p>
<p>양의 score는 1로 예측되고, 음의 score는 0으로 예측된다.</p>
<div id="913cd649-5002-4b75-8cba-31b2e80d3128" class="cell" data-tags="[]" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>score_list <span class="op">=</span> []</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, X_test.shape[<span class="dv">0</span>]): <span class="co">#</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    s1 <span class="op">=</span> df_tree[df_tree[<span class="st">"ID"</span>] <span class="op">==</span> <span class="st">"0-"</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">int</span>(applied[i, <span class="dv">0</span>]))]  <span class="co"># 첫번째 트리의 해당 노드에서 score 가져오기</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    s2 <span class="op">=</span> df_tree[df_tree[<span class="st">"ID"</span>] <span class="op">==</span> <span class="st">"1-"</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">int</span>(applied[i, <span class="dv">1</span>]))]  <span class="co"># 두번째 트리의 해당 노드에서 score 가져오기</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    score_list.append(s1.iloc[<span class="dv">0</span>][<span class="st">"Gain"</span>] <span class="op">+</span> s2.iloc[<span class="dv">0</span>][<span class="st">"Gain"</span>])   <span class="co"># 각 트리의 leaf 노드 가중치들의 합</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">"prediction"</span>: xg_clf.predict(X_test), <span class="st">"score"</span>: score_list})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">prediction</th>
<th data-quarto-table-cell-role="th">score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0</td>
<td>-0.507601</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1</td>
<td>0.009282</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>0</td>
<td>-0.507601</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>0</td>
<td>-0.507601</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>0</td>
<td>-0.563773</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>0</td>
<td>-0.563773</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>0</td>
<td>-0.563773</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>0</td>
<td>-0.563773</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>0</td>
<td>-0.507601</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>1</td>
<td>0.009282</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>0</td>
<td>-0.507601</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>0</td>
<td>-0.507601</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>0</td>
<td>-0.507601</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>1</td>
<td>0.009282</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>0</td>
<td>-0.563773</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>1</td>
<td>0.009282</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>1</td>
<td>0.009282</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>0</td>
<td>-0.507601</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>1</td>
<td>0.009282</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">19</th>
<td>0</td>
<td>-0.563773</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">20</th>
<td>0</td>
<td>-0.563773</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">21</th>
<td>1</td>
<td>0.009282</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>0</td>
<td>-0.563773</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>0</td>
<td>-0.563773</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">24</th>
<td>0</td>
<td>-0.507601</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">25</th>
<td>0</td>
<td>-0.563773</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">26</th>
<td>1</td>
<td>0.009282</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">27</th>
<td>1</td>
<td>0.009282</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">28</th>
<td>0</td>
<td>-0.507601</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">29</th>
<td>1</td>
<td>0.009282</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>이번에는 Weak learner들의 max depth를 2로 늘리고, boosting 횟수를 3으로 늘렸다.</p>
<p>부스팅 단계에서 트리가 완전히 2번 분할되기도 하고 그렇지 않기도 함을 관찰할 수 있다.</p>
<div id="76b09386-f689-4e7d-817c-ab5c834330d2" class="cell" data-tags="[]" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>xg_clf2 <span class="op">=</span> XGBClassifier(n_estimators<span class="op">=</span><span class="dv">3</span>, max_depth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>xg_clf2.fit(X_train, y_train)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>booster2 <span class="op">=</span> xg_clf2.get_booster()</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>booster2.feature_names <span class="op">=</span> <span class="bu">list</span>(data.feature_names)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>tree_list2 <span class="op">=</span> booster2.get_dump()</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, tree <span class="kw">in</span> <span class="bu">enumerate</span>(tree_list2):</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Tree </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">:</span><span class="ch">\n</span><span class="sc">{</span>tree<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tree 0:
0:[petal length (cm)&lt;2.5999999] yes=1,no=2,missing=1
    1:leaf=-0.545454562
    2:[petal width (cm)&lt;1.6500001] yes=3,no=4,missing=3
        3:leaf=0.443478286
        4:leaf=-0.54285717


Tree 1:
0:[petal length (cm)&lt;2.5999999] yes=1,no=2,missing=1
    1:leaf=-0.427828759
    2:[petal length (cm)&lt;4.85000038] yes=3,no=4,missing=3
        3:leaf=0.396398216
        4:leaf=-0.394053072


Tree 2:
0:[petal width (cm)&lt;1.6500001] yes=1,no=2,missing=1
    1:[petal length (cm)&lt;2.5999999] yes=3,no=4,missing=3
        3:leaf=-0.367224514
        4:leaf=0.295478225
    2:leaf=-0.378008872

</code></pre>
</div>
</div>
<div id="43d4473b-96f5-41d7-938b-0e7695834b77" class="cell" data-tags="[]" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df_tree2 <span class="op">=</span> booster2.trees_to_dataframe()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>df_tree2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Tree</th>
<th data-quarto-table-cell-role="th">Node</th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">Feature</th>
<th data-quarto-table-cell-role="th">Split</th>
<th data-quarto-table-cell-role="th">Yes</th>
<th data-quarto-table-cell-role="th">No</th>
<th data-quarto-table-cell-role="th">Missing</th>
<th data-quarto-table-cell-role="th">Gain</th>
<th data-quarto-table-cell-role="th">Cover</th>
<th data-quarto-table-cell-role="th">Category</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0</td>
<td>0</td>
<td>0-0</td>
<td>petal length (cm)</td>
<td>2.60</td>
<td>0-1</td>
<td>0-2</td>
<td>0-1</td>
<td>20.941208</td>
<td>30.000000</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>0</td>
<td>1</td>
<td>0-1</td>
<td>Leaf</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-0.545455</td>
<td>10.000000</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>0</td>
<td>2</td>
<td>0-2</td>
<td>petal width (cm)</td>
<td>1.65</td>
<td>0-3</td>
<td>0-4</td>
<td>0-3</td>
<td>59.320908</td>
<td>20.000000</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>0</td>
<td>3</td>
<td>0-3</td>
<td>Leaf</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.443478</td>
<td>10.500000</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>0</td>
<td>4</td>
<td>0-4</td>
<td>Leaf</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-0.542857</td>
<td>9.500000</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>1</td>
<td>0</td>
<td>1-0</td>
<td>petal length (cm)</td>
<td>2.60</td>
<td>1-1</td>
<td>1-2</td>
<td>1-1</td>
<td>12.013302</td>
<td>28.124876</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>1</td>
<td>1</td>
<td>1-1</td>
<td>Leaf</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-0.427829</td>
<td>9.291584</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>1</td>
<td>2</td>
<td>1-2</td>
<td>petal length (cm)</td>
<td>4.85</td>
<td>1-3</td>
<td>1-4</td>
<td>1-3</td>
<td>36.024929</td>
<td>18.833292</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>1</td>
<td>3</td>
<td>1-3</td>
<td>Leaf</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.396398</td>
<td>8.798397</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>1</td>
<td>4</td>
<td>1-4</td>
<td>Leaf</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-0.394053</td>
<td>10.034896</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>2</td>
<td>0</td>
<td>2-0</td>
<td>petal width (cm)</td>
<td>1.65</td>
<td>2-1</td>
<td>2-2</td>
<td>2-1</td>
<td>8.366964</td>
<td>24.860750</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>2</td>
<td>1</td>
<td>2-1</td>
<td>petal length (cm)</td>
<td>2.60</td>
<td>2-3</td>
<td>2-4</td>
<td>2-3</td>
<td>23.189529</td>
<td>17.081751</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>2</td>
<td>2</td>
<td>2-2</td>
<td>Leaf</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-0.378009</td>
<td>7.778998</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>2</td>
<td>3</td>
<td>2-3</td>
<td>Leaf</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-0.367225</td>
<td>7.961054</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>2</td>
<td>4</td>
<td>2-4</td>
<td>Leaf</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.295478</td>
<td>9.120698</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="22dcb3f0-226d-4b90-90bc-f2c91d8c0964" class="cell" data-tags="[]" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>applied2 <span class="op">=</span> xg_clf2.<span class="bu">apply</span>(df_X_test)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>applied2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>array([[1., 1., 3.],
       [3., 3., 4.],
       [1., 1., 3.],
       [1., 1., 3.],
       [4., 4., 2.],
       [4., 4., 2.],
       [4., 4., 2.],
       [4., 4., 2.],
       [1., 1., 3.],
       [3., 3., 4.],
       [1., 1., 3.],
       [1., 1., 3.],
       [1., 1., 3.],
       [3., 3., 4.],
       [4., 4., 2.],
       [3., 3., 4.],
       [3., 3., 4.],
       [1., 1., 3.],
       [3., 3., 4.],
       [4., 4., 2.],
       [4., 4., 2.],
       [3., 3., 4.],
       [4., 4., 2.],
       [4., 3., 2.],
       [1., 1., 3.],
       [4., 3., 2.],
       [3., 3., 4.],
       [3., 3., 4.],
       [1., 1., 3.],
       [3., 3., 4.]], dtype=float32)</code></pre>
</div>
</div>
<p>이번에는 트리가 3개이기 때문에, <code>for</code>문 내에서 스코어를 3번 추출하여 계산한다.</p>
<p>어떤 테스트 데이터에 대한 총 score는 각 트리의 leaf 노드에서 추출한 score들의 합이다.</p>
<p>마찬가지로 score에 따라 최종 prediction이 어떻게 이루어졌는지 관찰하자.</p>
<p>이전에 공부한 것처럼 score값들은 sigmoid 함수를 이용하여 확률값으로 변환할 수 있다.</p>
<p>이것은 <a href="https://xgboost.readthedocs.io/en/stable/python/python_api.html#xgboost.XGBClassifier.predict_proba"><code>predict_prob</code></a>에서 계산한 값과 같다.</p>
<div id="07aec593" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="7b8df3a1-398b-4476-8a8d-5e7c8cfc850f" class="cell" data-tags="[]" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>score_list2 <span class="op">=</span> []</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, X_test.shape[<span class="dv">0</span>]):</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    total_score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(xg_clf2.n_estimators):</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>        selected_raw <span class="op">=</span> df_tree2[df_tree2[<span class="st">"ID"</span>] <span class="op">==</span> <span class="ss">f"</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">-"</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">int</span>(applied2[i, j]))]</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>        total_score <span class="op">+=</span> selected_raw.iloc[<span class="dv">0</span>][<span class="st">"Gain"</span>]</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    score_list2.append(total_score)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>prob <span class="op">=</span> <span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>np.array(score_list2)))</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">"prediction"</span>: xg_clf2.predict(X_test), <span class="st">"score"</span>: score_list2, <span class="st">"prob_by_score"</span> : prob, <span class="st">"P(Y=1)"</span> : xg_clf2.predict_proba(X_test)[:,<span class="dv">1</span>].reshape(<span class="op">-</span><span class="dv">1</span>)})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">prediction</th>
<th data-quarto-table-cell-role="th">score</th>
<th data-quarto-table-cell-role="th">prob_by_score</th>
<th data-quarto-table-cell-role="th">P(Y=1)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0</td>
<td>-1.340508</td>
<td>0.207427</td>
<td>0.207427</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1</td>
<td>1.135355</td>
<td>0.756826</td>
<td>0.756826</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>0</td>
<td>-1.340508</td>
<td>0.207427</td>
<td>0.207427</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>0</td>
<td>-1.340508</td>
<td>0.207427</td>
<td>0.207427</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>0</td>
<td>-1.314919</td>
<td>0.211665</td>
<td>0.211665</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>0</td>
<td>-1.314919</td>
<td>0.211665</td>
<td>0.211665</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>0</td>
<td>-1.314919</td>
<td>0.211665</td>
<td>0.211665</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>0</td>
<td>-1.314919</td>
<td>0.211665</td>
<td>0.211665</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>0</td>
<td>-1.340508</td>
<td>0.207427</td>
<td>0.207427</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>1</td>
<td>1.135355</td>
<td>0.756826</td>
<td>0.756826</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>0</td>
<td>-1.340508</td>
<td>0.207427</td>
<td>0.207427</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>0</td>
<td>-1.340508</td>
<td>0.207427</td>
<td>0.207427</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>0</td>
<td>-1.340508</td>
<td>0.207427</td>
<td>0.207427</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>1</td>
<td>1.135355</td>
<td>0.756826</td>
<td>0.756826</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>0</td>
<td>-1.314919</td>
<td>0.211665</td>
<td>0.211665</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>1</td>
<td>1.135355</td>
<td>0.756826</td>
<td>0.756826</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>1</td>
<td>1.135355</td>
<td>0.756826</td>
<td>0.756826</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>0</td>
<td>-1.340508</td>
<td>0.207427</td>
<td>0.207427</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>1</td>
<td>1.135355</td>
<td>0.756826</td>
<td>0.756826</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">19</th>
<td>0</td>
<td>-1.314919</td>
<td>0.211665</td>
<td>0.211665</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">20</th>
<td>0</td>
<td>-1.314919</td>
<td>0.211665</td>
<td>0.211665</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">21</th>
<td>1</td>
<td>1.135355</td>
<td>0.756826</td>
<td>0.756826</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>0</td>
<td>-1.314919</td>
<td>0.211665</td>
<td>0.211665</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>0</td>
<td>-0.524468</td>
<td>0.371808</td>
<td>0.371808</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">24</th>
<td>0</td>
<td>-1.340508</td>
<td>0.207427</td>
<td>0.207427</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">25</th>
<td>0</td>
<td>-0.524468</td>
<td>0.371808</td>
<td>0.371808</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">26</th>
<td>1</td>
<td>1.135355</td>
<td>0.756826</td>
<td>0.756826</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">27</th>
<td>1</td>
<td>1.135355</td>
<td>0.756826</td>
<td>0.756826</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">28</th>
<td>0</td>
<td>-1.340508</td>
<td>0.207427</td>
<td>0.207427</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">29</th>
<td>1</td>
<td>1.135355</td>
<td>0.756826</td>
<td>0.756826</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>마지막으로 하이퍼파라미터들을 따로 셋팅하지 않고, xgboost를 진행해 본다.</p>
<p>xgboost의 파라미터 기본 셋팅은 다음 링크를 참조한다.</p>
<p>https://xgboost.readthedocs.io/en/stable/parameter.html</p>
<p>예를 들어, <code>max_depth</code>의 기본값은 6이다.</p>
<div id="9b4fd065" class="cell" data-scrolled="true" data-tags="[]" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>xg_clf_d <span class="op">=</span> XGBClassifier()</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>xg_clf_d.fit(X_train, y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<style>#sk-container-id-3 {color: black;background-color: white;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=None, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              n_estimators=100, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=None, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" checked=""><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">XGBClassifier</label><div class="sk-toggleable__content"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=None, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              n_estimators=100, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=None, ...)</pre></div></div></div></div></div>
</div>
</div>
<div id="c15bb234-b61f-4289-abfa-7cd5850dff0a" class="cell" data-tags="[]" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">"prediction"</span> : xg_clf_d.predict(X_test), <span class="st">"real _value"</span> :y_test})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">prediction</th>
<th data-quarto-table-cell-role="th">real _value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">19</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">20</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">21</th>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">24</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">25</th>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">26</th>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">27</th>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">28</th>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">29</th>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="84f2f18e-8f65-4e5c-9345-d7eca3e314fa" class="cell" data-tags="[]" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#상당히 많은 트리들을 볼 수 있다.</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>boosters <span class="op">=</span> xg_clf_d.get_booster()</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>boosters.feature_names <span class="op">=</span> <span class="bu">list</span>(data.feature_names)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>tree_list <span class="op">=</span> boosters.get_dump()</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tree_list)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>100</code></pre>
</div>
</div>
<div id="5d0ff88f" class="cell" data-execution_count="27">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tree_list[<span class="dv">0</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0:[petal length (cm)&lt;2.5999999] yes=1,no=2,missing=1
    1:leaf=-0.545454562
    2:[petal width (cm)&lt;1.6500001] yes=3,no=4,missing=3
        3:[petal length (cm)&lt;4.94999981] yes=5,no=6,missing=5
            5:leaf=0.541463435
            6:leaf=-0.200000018
        4:leaf=-0.54285717
</code></pre>
</div>
</div>
<div id="52de868d" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tree_list[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0:[petal length (cm)&lt;2.5999999] yes=1,no=2,missing=1
    1:leaf=-0.427828759
    2:[petal width (cm)&lt;1.6500001] yes=3,no=4,missing=3
        3:[petal length (cm)&lt;4.94999981] yes=5,no=6,missing=5
            5:leaf=0.425154209
            6:leaf=-0.167702854
        4:leaf=-0.426088065
</code></pre>
</div>
</div>
<div id="1cc0cfe0" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df_tree_d <span class="op">=</span> xg_clf_d.get_booster().trees_to_dataframe()</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>applied_d <span class="op">=</span> xg_clf_d.<span class="bu">apply</span>(df_X_test)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>score_list_d <span class="op">=</span> []</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, X_test.shape[<span class="dv">0</span>]):</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    total_score <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(xg_clf_d.n_estimators):</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>        selected_raw <span class="op">=</span> df_tree_d[df_tree_d[<span class="st">"ID"</span>] <span class="op">==</span> <span class="ss">f"</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">-"</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">int</span>(applied_d[i, j]))]</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>        total_score <span class="op">+=</span> selected_raw.iloc[<span class="dv">0</span>][<span class="st">"Gain"</span>]</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    score_list_d.append(total_score)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>prob <span class="op">=</span> <span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>np.array(score_list_d)))</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">"prediction"</span>: xg_clf_d.predict(X_test), <span class="st">"score"</span>: score_list_d, <span class="st">"prob_by_score"</span> : prob, <span class="op">\</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">"P(Y=1)"</span> : xg_clf_d.predict_proba(X_test)[:,<span class="dv">1</span>].reshape(<span class="op">-</span><span class="dv">1</span>)})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">prediction</th>
<th data-quarto-table-cell-role="th">score</th>
<th data-quarto-table-cell-role="th">prob_by_score</th>
<th data-quarto-table-cell-role="th">P(Y=1)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0</td>
<td>-4.676945</td>
<td>0.009222</td>
<td>0.009222</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1</td>
<td>4.076972</td>
<td>0.983324</td>
<td>0.983324</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>0</td>
<td>-4.676945</td>
<td>0.009222</td>
<td>0.009222</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>0</td>
<td>-3.501430</td>
<td>0.029272</td>
<td>0.029272</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>0</td>
<td>-5.738795</td>
<td>0.003208</td>
<td>0.003208</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>0</td>
<td>-5.738795</td>
<td>0.003208</td>
<td>0.003208</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>0</td>
<td>-5.738795</td>
<td>0.003208</td>
<td>0.003208</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>0</td>
<td>-4.858024</td>
<td>0.007706</td>
<td>0.007706</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>0</td>
<td>-4.676945</td>
<td>0.009222</td>
<td>0.009222</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>1</td>
<td>4.373553</td>
<td>0.987551</td>
<td>0.987551</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>0</td>
<td>-4.676945</td>
<td>0.009222</td>
<td>0.009222</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>0</td>
<td>-4.676945</td>
<td>0.009222</td>
<td>0.009222</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>0</td>
<td>-4.676945</td>
<td>0.009222</td>
<td>0.009222</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>1</td>
<td>2.710509</td>
<td>0.937644</td>
<td>0.937644</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>0</td>
<td>-5.738795</td>
<td>0.003208</td>
<td>0.003208</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">15</th>
<td>1</td>
<td>3.854214</td>
<td>0.979249</td>
<td>0.979249</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">16</th>
<td>1</td>
<td>3.807979</td>
<td>0.978289</td>
<td>0.978289</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">17</th>
<td>0</td>
<td>-4.676945</td>
<td>0.009222</td>
<td>0.009222</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">18</th>
<td>1</td>
<td>4.076972</td>
<td>0.983324</td>
<td>0.983324</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">19</th>
<td>0</td>
<td>-5.738795</td>
<td>0.003208</td>
<td>0.003208</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">20</th>
<td>0</td>
<td>-5.738795</td>
<td>0.003208</td>
<td>0.003208</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">21</th>
<td>1</td>
<td>3.854214</td>
<td>0.979249</td>
<td>0.979249</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">22</th>
<td>0</td>
<td>-5.299762</td>
<td>0.004968</td>
<td>0.004968</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">23</th>
<td>0</td>
<td>-2.473315</td>
<td>0.077750</td>
<td>0.077750</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">24</th>
<td>0</td>
<td>-4.676945</td>
<td>0.009222</td>
<td>0.009222</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">25</th>
<td>0</td>
<td>-3.149107</td>
<td>0.041126</td>
<td>0.041126</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">26</th>
<td>1</td>
<td>4.076972</td>
<td>0.983324</td>
<td>0.983324</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">27</th>
<td>1</td>
<td>2.864694</td>
<td>0.946073</td>
<td>0.946073</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">28</th>
<td>0</td>
<td>-4.676945</td>
<td>0.009222</td>
<td>0.009222</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">29</th>
<td>1</td>
<td>4.287761</td>
<td>0.986450</td>
<td>0.986450</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="예제-make_hastie_10_2" class="level3" data-number="12.0.9">
<h3 data-number="12.0.9" class="anchored" data-anchor-id="예제-make_hastie_10_2"><span class="header-section-number">12.0.9</span> 예제 : <code>make_hastie_10_2</code></h3>
<p><a href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.make_hastie_10_2.html"><code>make_hastie_10_2</code></a>데이터 를 이용하여 XGBoost와 일반 gradient boosting의 속도를 비교해 보자.</p>
<div id="1c5e61c3-9607-45a3-8602-263b03140ca9" class="cell" data-tags="[]" data-execution_count="30">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> datasets</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>X, y <span class="op">=</span> datasets.make_hastie_10_2(n_samples<span class="op">=</span><span class="dv">12_000</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>y[y <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    X, y, test_size<span class="op">=</span><span class="dv">2_000</span>, shuffle<span class="op">=</span><span class="va">False</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="1bb78528-ddd9-4008-bec7-70e9b10ba0e9" class="cell" data-tags="[]" data-execution_count="31">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>xgb_clf <span class="op">=</span> XGBClassifier(n_estimators <span class="op">=</span> <span class="dv">400</span>, max_depth<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="505557f4-04a8-4a0c-a336-b14a481dca4d" class="cell" data-tags="[]" data-execution_count="32">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>xgb_clf.fit(X_train, y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>666 ms ± 11.5 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</code></pre>
</div>
</div>
<div id="1522aa08-dfed-4fa7-bded-9c58fccaf5ed" class="cell" data-tags="[]" data-execution_count="33">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>xgb_clf.score(X_test, y_test)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>0.9485</code></pre>
</div>
</div>
<div id="7551f15c-643c-4fa7-b1c7-a67ef30a66d4" class="cell" data-tags="[]" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> GradientBoostingClassifier</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>n_estimators <span class="op">=</span> <span class="dv">400</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>gb_clf <span class="op">=</span> GradientBoostingClassifier(n_estimators<span class="op">=</span>n_estimators, max_depth<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="f7505296-5acb-4ad3-b676-fa24e1a47e47" class="cell" data-tags="[]" data-execution_count="35">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>gb_clf .fit(X_train, y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>9.5 s ± 462 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</code></pre>
</div>
</div>
<div id="03cc212e-0723-4853-83eb-7c764e5b3524" class="cell" data-tags="[]" data-execution_count="36">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>gb_clf.score(X_test, y_test)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>0.9005</code></pre>
</div>
</div>
</section>
<section id="하이퍼-파라미터" class="level3" data-number="12.0.10">
<h3 data-number="12.0.10" class="anchored" data-anchor-id="하이퍼-파라미터"><span class="header-section-number">12.0.10</span> 하이퍼 파라미터</h3>
<p>심장병 판별 자료 예제를 이용하여 XGBoost에서 하이퍼 파라미터를 어떻게 설정하는지 간단히 알아보자.</p>
<div id="ed28fcfa-e387-4668-8b6d-f063e1c175e6" class="cell" data-tags="[]" data-execution_count="37">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/rickiepark/handson-gb/main/Chapter02/heart_disease.csv"</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">cp</th>
<th data-quarto-table-cell-role="th">trestbps</th>
<th data-quarto-table-cell-role="th">chol</th>
<th data-quarto-table-cell-role="th">fbs</th>
<th data-quarto-table-cell-role="th">restecg</th>
<th data-quarto-table-cell-role="th">thalach</th>
<th data-quarto-table-cell-role="th">exang</th>
<th data-quarto-table-cell-role="th">oldpeak</th>
<th data-quarto-table-cell-role="th">slope</th>
<th data-quarto-table-cell-role="th">ca</th>
<th data-quarto-table-cell-role="th">thal</th>
<th data-quarto-table-cell-role="th">target</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>63</td>
<td>1</td>
<td>3</td>
<td>145</td>
<td>233</td>
<td>1</td>
<td>0</td>
<td>150</td>
<td>0</td>
<td>2.3</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>37</td>
<td>1</td>
<td>2</td>
<td>130</td>
<td>250</td>
<td>0</td>
<td>1</td>
<td>187</td>
<td>0</td>
<td>3.5</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>41</td>
<td>0</td>
<td>1</td>
<td>130</td>
<td>204</td>
<td>0</td>
<td>0</td>
<td>172</td>
<td>0</td>
<td>1.4</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>56</td>
<td>1</td>
<td>1</td>
<td>120</td>
<td>236</td>
<td>0</td>
<td>1</td>
<td>178</td>
<td>0</td>
<td>0.8</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>57</td>
<td>0</td>
<td>0</td>
<td>120</td>
<td>354</td>
<td>0</td>
<td>1</td>
<td>163</td>
<td>1</td>
<td>0.6</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="97dea76c-572b-40fa-9256-9fcfd38db7bf" class="cell" data-tags="[]" data-execution_count="38">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 303 entries, 0 to 302
Data columns (total 14 columns):
 #   Column    Non-Null Count  Dtype  
---  ------    --------------  -----  
 0   age       303 non-null    int64  
 1   sex       303 non-null    int64  
 2   cp        303 non-null    int64  
 3   trestbps  303 non-null    int64  
 4   chol      303 non-null    int64  
 5   fbs       303 non-null    int64  
 6   restecg   303 non-null    int64  
 7   thalach   303 non-null    int64  
 8   exang     303 non-null    int64  
 9   oldpeak   303 non-null    float64
 10  slope     303 non-null    int64  
 11  ca        303 non-null    int64  
 12  thal      303 non-null    int64  
 13  target    303 non-null    int64  
dtypes: float64(1), int64(13)
memory usage: 33.3 KB</code></pre>
</div>
</div>
<div id="f1ead09f-5849-44a9-8c31-7b699276cfa5" class="cell" data-tags="[]" data-execution_count="39">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBClassifier</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="675f0519-21ce-45ac-bb55-a36e33b5d86b" class="cell" data-tags="[]" data-execution_count="40">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df.iloc[:, :<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df.iloc[:, <span class="op">-</span><span class="dv">1</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>아래 코드에서 <code>booster = "gbtree", objective = "binary:logistic"</code>는 사실 <code>XGBClassifier</code>의 default 값들이다.</p>
<div id="c05df3f6-da9d-4d5f-b6c1-b2b93be63258" class="cell" data-tags="[]" data-execution_count="41">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> XGBClassifier(booster <span class="op">=</span> <span class="st">"gbtree"</span>, objective <span class="op">=</span> <span class="st">"binary:logistic"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>위 모델을 이용하여 5-fold cross validation 에러를 계산해 보자.</p>
<div id="5cbf194e-dea1-403c-862a-b90c97b330cd" class="cell" data-tags="[]" data-execution_count="42">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> cross_val_score(model, X, y, cv<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>scores.mean()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>0.8149726775956283</code></pre>
</div>
</div>
<p>한편, <a href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.StratifiedKFold.html"><code>sklearn.model_selection.StratifiedKFold</code></a>는 <span class="math inline">\(y\)</span>의 클래스의 비율을 일정하게 하여 k-fold cross-validation을 하게 하므로, 더 정확한 테스트 에러 추정치를 얻을 수 있다고 알려져 있다.</p>
<div id="52e94d19-1e49-4cdf-8c1a-6f4494ae3883" class="cell" data-tags="[]" data-execution_count="43">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> StratifiedKFold</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>kfold <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">False</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="c24e3320-ff51-4a42-85ef-093c8e811dbf" class="cell" data-tags="[]" data-execution_count="44">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> cross_val_score(model, X, y, cv<span class="op">=</span>kfold)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>scores.mean()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>0.8149726775956283</code></pre>
</div>
</div>
<p>하이퍼파라미터 튜닝은 기본적으로 <a href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html"><code>sklearn.model_selection.GridSearchCV</code></a> 나 <a href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.RandomizedSearchCV.html"><code>sklearn.model_selection.RandomizedSearchCV</code></a>을 이용한다.</p>
<p><code>sklearn.model_selection.GridSearchCV</code>는 하이퍼 파라미터들이 가질 수 있는 여러 값들을 그리드 형태로 지정하여 모두 테스트 하는 방식이다.</p>
<p><code>param_grid</code>는 탐색할 파라미터 값들의 리스트를 나타내며, 파라미터 이름을 key로 삼아 dictionary로 표현된다.</p>
<p>비슷하게 <code>sklearn.model_selection.RandomizedSearchCV</code>는 탐색할 파라미터가 램덤하게 샘플링될 분포를 <code>param_distributions</code>로 제공해 주어야 한다.</p>
<div id="ed744023-1405-4714-9849-7a9df4f8d7c7" class="cell" data-tags="[]" data-execution_count="45">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV, RandomizedSearchCV</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>많은 하이퍼 파라미터들에 대해 비슷한 작업을 수행할 것이므로, 함수로 만들어 사용해 보자.</p>
<p><code>random</code>이 <code>False</code>일 경우 grid search를, <code>True</code>일 경우 Randomized search를 한다.</p>
<div id="0256a57a-4509-49fd-ae2d-1b6c7af6810c" class="cell" data-tags="[]" data-execution_count="46">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> grid_search(params, random<span class="op">=</span><span class="va">False</span>): </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    xgb <span class="op">=</span> XGBClassifier(booster<span class="op">=</span><span class="st">'gbtree'</span>, objective<span class="op">=</span><span class="st">'binary:logistic'</span>, verbosity<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    kfold <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> random:</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>        grid <span class="op">=</span> RandomizedSearchCV(estimator <span class="op">=</span> xgb, param_distributions <span class="op">=</span> params, cv<span class="op">=</span>kfold, n_iter<span class="op">=</span><span class="dv">20</span>, </span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>                                  n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>        grid <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> xgb, param_grid <span class="op">=</span> params, cv<span class="op">=</span>kfold, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>    grid.fit(X, y)</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>    best_params <span class="op">=</span> grid.best_params_</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"최상의 매개변수:"</span>, best_params) </span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>    best_score <span class="op">=</span> grid.best_score_</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"최상의 점수: </span><span class="sc">{:.5f}</span><span class="st">"</span>.<span class="bu">format</span>(best_score))</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> grid</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="5421174a-1a3f-4517-a4d9-0b6c37edc3b3" class="cell" data-tags="[]" data-execution_count="47">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> grid_search(params<span class="op">=</span>{<span class="st">'n_estimators'</span>:[<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">400</span>, <span class="dv">800</span>]})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>최상의 매개변수: {'n_estimators': 400}
최상의 점수: 0.79563</code></pre>
</div>
</div>
<div id="c530624e-5b34-46db-8c14-265cf7693833" class="cell" data-tags="[]" data-execution_count="48">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> grid_search(params<span class="op">=</span>{<span class="st">'learning_rate'</span>:[<span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>]})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>최상의 매개변수: {'learning_rate': 0.5}
최상의 점수: 0.82530</code></pre>
</div>
</div>
<div id="f5836540-b5d7-4eb9-9968-0e91c7f1e3ca" class="cell" data-tags="[]" data-execution_count="49">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> grid_search(params<span class="op">=</span>{<span class="st">'max_depth'</span>:[<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">8</span>]})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>최상의 매개변수: {'max_depth': 2}
최상의 점수: 0.80552</code></pre>
</div>
</div>
<div id="08717359-5559-4966-9abd-cb52f2f56d89" class="cell" data-tags="[]" data-execution_count="50">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> grid_search(params<span class="op">=</span>{<span class="st">'gamma'</span>:[<span class="dv">0</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">2</span>]})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>최상의 매개변수: {'gamma': 2}
최상의 점수: 0.79202</code></pre>
</div>
</div>
<div id="3907e27b-6f2b-41d1-a159-480fbb8dd3a8" class="cell" data-tags="[]" data-execution_count="51">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> grid_search(params<span class="op">=</span>{<span class="st">'min_child_weight'</span>:[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>최상의 매개변수: {'min_child_weight': 5}
최상의 점수: 0.80530</code></pre>
</div>
</div>
<div id="1d3f0729-5ea7-4a5a-97cd-9b0671fd6b49" class="cell" data-tags="[]" data-execution_count="52">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> grid_search(params<span class="op">=</span>{<span class="st">'subsample'</span>:[<span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="dv">1</span>]})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>최상의 매개변수: {'subsample': 0.8}
최상의 점수: 0.80508</code></pre>
</div>
</div>
<div id="96ec3aab-4fcc-474b-9e6c-c8eb6c026ac9" class="cell" data-tags="[]" data-execution_count="53">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> grid_search(params<span class="op">=</span>{<span class="st">'colsample_bytree'</span>:[<span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="dv">1</span>]})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>최상의 매개변수: {'colsample_bytree': 0.5}
최상의 점수: 0.80180</code></pre>
</div>
</div>
<p>탐색의 대상이 너무 많을 때는 randomized search를 사용하는 것도 좋은 방법이다.</p>
<p>다음의 parameter 조합은 너무 많기 때문에, random search를 이용했다.</p>
<p>주어진 parameter 조합 중의 일부를 랜덤하게 선택하여 에러를 측정하는 방법이다.</p>
<div id="d922522c" class="cell" data-execution_count="54">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> grid_search(params<span class="op">=</span>{<span class="st">'subsample'</span>:[<span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="dv">1</span>], </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'min_child_weight'</span>:[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>], </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'learning_rate'</span>:[<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>], </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'max_depth'</span>:[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="va">None</span>], </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'n_estimators'</span>:[<span class="dv">2</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>]}, random<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>최상의 매개변수: {'subsample': 0.6, 'n_estimators': 50, 'min_child_weight': 4, 'max_depth': 5, 'learning_rate': 0.2}
최상의 점수: 0.83809</code></pre>
</div>
</div>
<div id="e9ce534e" class="cell" data-execution_count="55">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>grid.best_params_</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>{'subsample': 0.6,
 'n_estimators': 50,
 'min_child_weight': 4,
 'max_depth': 5,
 'learning_rate': 0.2}</code></pre>
</div>
</div>
<p><code>best_estimator_</code>는 최적의 하이퍼파라미터 조합으로 학습된 모델 객체이다.</p>
<div id="532fb768" class="cell" data-execution_count="56">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>grid.best_estimator_</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<style>#sk-container-id-4 {color: black;background-color: white;}#sk-container-id-4 pre{padding: 0;}#sk-container-id-4 div.sk-toggleable {background-color: white;}#sk-container-id-4 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-4 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-4 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-4 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-4 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-4 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-4 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-4 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-4 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-4 div.sk-item {position: relative;z-index: 1;}#sk-container-id-4 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-4 div.sk-item::before, #sk-container-id-4 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-4 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-4 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-4 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-4 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-4 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-4 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-4 div.sk-label-container {text-align: center;}#sk-container-id-4 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-4 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster='gbtree', callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=0.2, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=5, max_leaves=None,
              min_child_weight=4, missing=nan, monotone_constraints=None,
              n_estimators=50, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=None, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" checked=""><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">XGBClassifier</label><div class="sk-toggleable__content"><pre>XGBClassifier(base_score=None, booster='gbtree', callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=0.2, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=5, max_leaves=None,
              min_child_weight=4, missing=nan, monotone_constraints=None,
              n_estimators=50, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=None, ...)</pre></div></div></div></div></div>
</div>
</div>
<div id="fd0e704f" class="cell" data-execution_count="57">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>xgb_op <span class="op">=</span> grid.best_estimator_</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="24353606" class="cell" data-scrolled="true" data-execution_count="58">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>xgb_op.fit(X, y)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<style>#sk-container-id-5 {color: black;background-color: white;}#sk-container-id-5 pre{padding: 0;}#sk-container-id-5 div.sk-toggleable {background-color: white;}#sk-container-id-5 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-5 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-5 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-5 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-5 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-5 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-5 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-5 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-5 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-5 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-5 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-5 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-5 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-5 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-5 div.sk-item {position: relative;z-index: 1;}#sk-container-id-5 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-5 div.sk-item::before, #sk-container-id-5 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-5 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-5 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-5 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-5 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-5 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-5 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-5 div.sk-label-container {text-align: center;}#sk-container-id-5 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-5 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-5" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster='gbtree', callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=0.2, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=5, max_leaves=None,
              min_child_weight=4, missing=nan, monotone_constraints=None,
              n_estimators=50, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=None, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" checked=""><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">XGBClassifier</label><div class="sk-toggleable__content"><pre>XGBClassifier(base_score=None, booster='gbtree', callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=0.2, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=5, max_leaves=None,
              min_child_weight=4, missing=nan, monotone_constraints=None,
              n_estimators=50, n_jobs=None, num_parallel_tree=None,
              predictor=None, random_state=None, ...)</pre></div></div></div></div></div>
</div>
</div>
<p><a href="https://xgboost.readthedocs.io/en/stable/python/python_api.html#xgboost.XGBClassifier.feature_importances_"><code>feature_importnaces_</code></a>는 XGBoost 모델에서 각 피처(변수)의 중요도를 나타내는 속성이다.</p>
<p>중요도는 해당 피처가 모델의 예측에 얼마나 큰 영향을 미치는지를 나타내는 값으로 해석된다.</p>
<div id="8076149c" class="cell" data-execution_count="59">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>xgb_op.feature_importances_</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>array([0.05681977, 0.06852973, 0.16221899, 0.03768466, 0.03900969,
       0.        , 0.05667366, 0.04874108, 0.12303892, 0.06358536,
       0.0478664 , 0.1325147 , 0.1633171 ], dtype=float32)</code></pre>
</div>
</div>
<div id="7dda3d72" class="cell" data-execution_count="60">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>importances <span class="op">=</span> xgb_op.feature_importances_</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 중요도를 기준으로 내림차순 정렬하여 feature 이름과 중요도를 출력</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>sorted_indices <span class="op">=</span> importances.argsort()[::<span class="op">-</span><span class="dv">1</span>]  <span class="co"># 중요도를 기준으로 내림차순 정렬된 인덱스</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>sorted_importances <span class="op">=</span> importances[sorted_indices]</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>sorted_feature_names <span class="op">=</span> X.columns[sorted_indices]</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> feature_name, importance <span class="kw">in</span> <span class="bu">zip</span>(sorted_feature_names, sorted_importances):</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Feature: </span><span class="sc">{</span>feature_name<span class="sc">}</span><span class="ss">, Importance: </span><span class="sc">{</span>importance<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Feature: thal, Importance: 0.16331709921360016
Feature: cp, Importance: 0.16221898794174194
Feature: ca, Importance: 0.13251470029354095
Feature: exang, Importance: 0.12303891777992249
Feature: sex, Importance: 0.06852973252534866
Feature: oldpeak, Importance: 0.06358535587787628
Feature: age, Importance: 0.05681977421045303
Feature: restecg, Importance: 0.05667366459965706
Feature: thalach, Importance: 0.04874107986688614
Feature: slope, Importance: 0.047866400331258774
Feature: chol, Importance: 0.0390096940100193
Feature: trestbps, Importance: 0.03768466040492058
Feature: fbs, Importance: 0.0</code></pre>
</div>
</div>
<div id="dae59a40" class="cell" data-execution_count="61">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> plot_importance</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> plot_importance(xgb_op, importance_type<span class="op">=</span><span class="st">'gain'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="12. XGBoost_files/figure-html/cell-62-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./11. Boosting.html" class="pagination-link" aria-label="Boosting">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Boosting</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./13. LightGBM.html" class="pagination-link" aria-label="LightGBM">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">LightGBM</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>